<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Lecture 2: Choice of the Target Allocation Ratio in Clinical Trials</title>
    <meta charset="utf-8" />
    <meta name="author" content="Yevgen Ryeznik 1 © and Oleksandr Sverdlov 2 ©" />
    <meta name="date" content="2018-04-04" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Lecture 2: Choice of the Target Allocation Ratio in Clinical Trials
## Uppsala University CIM course
### Yevgen Ryeznik <sup>1 ©</sup> and Oleksandr Sverdlov <sup>2 ©</sup>
### <sup>1</sup>Department of Mathematics, Uppsala University
### <sup>2</sup>Early Development Biostatistics, Novartis Institutes for Biomedical Research
### April 04, 2018

---






class: inverse, left, middle

## Agenda

1. Maximizing power of treatment comparison

2. Maximizing estimation precision of treatment effects and contrasts

3. Optimal allocation designs to balance statistical efficiency and ethical considerations

4. Optimal designs for dose-response studies

---

# Background

The design of any clinical trial starts with formulation of study objectives, e.g.:

- To test whether the effect of an experimental treatment is different from control

- To estimate treatment contrasts (experimental group vs. control)
    
- To minimize the number of treatment failures while maintaining study power

- To estimate dose-response relationship

- Etc. ...

--

Once study objectives are quantified, one may want to obtain an _**optimal design to achieve the desired objectives**_.

---

# Statistical methodologies

&lt;table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Hypothesis Testing &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Estimation &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; Research Question(s) &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; Is experimental treatment better than control? (Yes/No) &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; - What is the mean difference between experimental and control?
 - What is the estimated dose-response curve? &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Statistical Tool &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Test of significance (e.g. two-sample t-test) &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Estimator &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; Criteria for "goodness" &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; - Statistical test should have **high power** to detect
statisticaly significant difference between groups
 - **Validity** -- Pr(type I error) should be maintained at the nominal level (e.g. 5%) &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; Estimators should be **unbiased** and have **low variance** &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---
class: inverse, center, middle

# 1. Maximizing power of treatment comparison

---

# Maximizing power of a 2-arm comparative trial

- Two groups: Experimental (E) and Control (C).
- Sample size: a total of `\(n = n_E+n_C\)` subjects:
  + `\(n_E = \rho n\)` assigned to E, and `\(n_C = (1-\rho)n\)` assigned to C (if necessary, rounded to the integer values).
  + `\(\rho \in (0, 1)\)` -- "_**allocation ratio**_".
    
- Primary outcomes: `\(Y_{ik}\sim Normal(\mu_k, \sigma^2)\)`, `\(k=E,C\)`; `\(i = 1, 2, \ldots, n_k\)`:
  + `\(\sigma\)` _**is common for both groups, assumed known**_.

- Study objective: to test `\(H_0: \mu_E = \mu_C\)` vs. `\(H_1: \mu_E &gt; \mu_C\)` (experimental is better than control).

- `\(Z\)`-test: reject `\(H_0\)` at level `\(\alpha\)`, if `\(Z = \frac{\overline{Y}_E-\overline{Y}_C}{\sigma\sqrt{\frac{1}{n_E}+\frac{1}{n_C}}} &gt; z_{1-\alpha}\)` 
  + (e.g., `\(\alpha=0.05 \Rightarrow\)` reject `\(H_0\)` at 5% significance level, if `\(Z &gt; 1.645\)`).

---

# Which allocation maximizes power? (1 of 2)

`$$\begin{aligned}
 \boldsymbol{Power} &amp;= \text{Pr}(\text{Reject} H_0|n_E, n_C, \mu_E, \mu_C, \sigma^2, z_{1-\alpha}) = \\ \\
&amp;= \text{Pr}\left(\frac{\overline{Y}_E-\overline{Y}_C}{\sigma\sqrt{\frac{1}{n_E}+\frac{1}{n_C}}} &gt; z_{1-\alpha}\right) \underset{\text{under }H_1}{=} \\
&amp;\underset{\text{under }H_1}{=} \text{Pr}\left(\underbrace{\frac{\overline{Y}_E-\overline{Y}_C - (\mu_E-\mu_C)}{\sigma\sqrt{\frac{1}{n_E}+\frac{1}{n_C}}}}_{Z_0\sim N(0, 1)\text{ with c.d.f. }\Phi(z)} + \underbrace{\frac{(\mu_E-\mu_C)}{\sigma\sqrt{\frac{1}{n_E}+\frac{1}{n_C}}}}_{\Delta &gt; 0 \text{ (}\mu_E&gt;\mu_C\text{ under }H_1\text{)}} &gt; z_{1-\alpha}\right) = \\ \\
&amp;= \text{Pr}\left(Z_0+\Delta &gt; z_{1-\alpha}\right) = 1-\Phi\left(z_{1-\alpha}-\Delta\right) \Rightarrow
\end{aligned}$$`

--

`$$\\ \boxed{\max_{\rho \in (0, 1)}\boldsymbol{Power} \Leftrightarrow \min_{\rho \in (0, 1)}\Phi\left(z_{1-\alpha}-\Delta\right) \Leftrightarrow \max_{\rho \in (0, 1)}\Delta}$$`
---

# Which allocation maximizes power? (2 of 2)

- `\(\max\limits_{\rho \in (0,1)}\Delta = \max\limits_{\rho \in (0,1)}\frac{\mu_E-\mu_C}{\sigma\sqrt{\frac{1}{n\rho}+\frac{1}{n(1-\rho)}}}\)`.

- Equivalently, `\(\min\limits_{\rho \in (0,1)}\left(\frac{1}{n\rho}+\frac{1}{n(1-\rho)}\right)\)`.

- Optimal solution is `\(\boldsymbol{\rho^* = \frac{1}{2}}\)` (_**equal allocation**_).

&lt;span style="background-color: #2F4F4F; color:white"&gt;
Therefore, for a 2-arm comparative trial with normal outcomes (with known variance, common to 2 groups), equal allocation `\(\left(n_E=n_c=\frac{n}{2}\right)\)` maximizes the power of `\(Z\)`-test for treatment comparison.
&lt;/span&gt;

.footnote[
[**Note**] Same result is obtained, if we consider a 2-sample `\(t\)`-test instead of `\(Z\)`-test.
]


---
class: inverse, center, middle

# Thanks you!

[**Back to the course page**](index.html)

.footnote[
Slides are created via the R package [**xaringan**](https://github.com/yihui/xaringan).
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
