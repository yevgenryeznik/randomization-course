<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Lecture 2: Choice of the Target Allocation Ratio in Clinical Trials</title>
    <meta charset="utf-8" />
    <meta name="author" content="Yevgen Ryeznik 1 © and Oleksandr Sverdlov 2 ©" />
    <meta name="date" content="2018-04-04" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Lecture 2: Choice of the Target Allocation Ratio in Clinical Trials
## Uppsala University CIM course
### Yevgen Ryeznik <sup>1 ©</sup> and Oleksandr Sverdlov <sup>2 ©</sup>
### <sup>1</sup>Department of Mathematics, Uppsala University
### <sup>2</sup>Early Development Biostatistics, Novartis Institutes for Biomedical Research
### April 04, 2018

---






class: inverse, left, middle

## Agenda

1. Maximizing power of treatment comparison

2. Maximizing estimation precision of treatment effects and contrasts

3. Optimal allocation designs to balance statistical efficiency and ethical considerations

4. Optimal designs for dose-response studies

---

# Background

The design of any clinical trial starts with formulation of study objectives, e.g.:

- To test whether the effect of an experimental treatment is different from control

- To estimate treatment contrasts (experimental group vs. control)
    
- To minimize the number of treatment failures while maintaining study power

- To estimate dose-response relationship

- etc.

--

Once study objectives are quantified, one may want to obtain an _**optimal design to achieve the desired objectives**_.

---

# Statistical methodologies

&lt;table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Hypothesis Testing &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Estimation &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; Research Question(s) &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; Is experimental treatment better than control? (Yes/No) &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; - What is the mean difference between experimental and control?
 - What is the estimated dose-response curve? &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Statistical Tool &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Test of significance (e.g. two-sample t-test) &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Estimator &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; Criteria for "goodness" &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; - Statistical test should have **high power** to detect
statisticaly significant difference between groups
 - **Validity** -- Pr(type I error) should be maintained at the nominal level (e.g. 5%) &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; Estimators should be **unbiased** and have **low variance** &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---
class: inverse, center, middle

# 1. Maximizing power of treatment comparison

---

# Maximizing power of a 2-arm comparative trial

- Two groups: Experimental (E) and Control (C).
- Sample size: a total of `\(n = n_E+n_C\)` subjects:
  + `\(n_E = \rho n\)` assigned to E, and `\(n_C = (1-\rho)n\)` assigned to C (if necessary, rounded to the integer values).
  + `\(\rho \in (0, 1)\)` -- "_**allocation ratio**_".
    
- Primary outcomes: `\(Y_{ik}\sim Normal(\mu_k, \sigma^2)\)`, `\(k=E,C\)`; `\(i = 1, 2, \ldots, n_k\)`:
  + `\(\sigma\)` _**is common for both groups, assumed known**_.

- Study objective: to test `\(H_0: \mu_E = \mu_C\)` vs. `\(H_1: \mu_E &gt; \mu_C\)` (experimental is better than control).

- `\(Z\)`-test: reject `\(H_0\)` at level `\(\alpha\)`, if `\(Z = \frac{\overline{Y}_E-\overline{Y}_C}{\sigma\sqrt{\frac{1}{n_E}+\frac{1}{n_C}}} &gt; z_{1-\alpha}\)` 
  + (e.g., `\(\alpha=0.05 \Rightarrow\)` reject `\(H_0\)` at 5% significance level, if `\(Z &gt; 1.645\)`).

---

# Which allocation maximizes power? (1 of 2)

`$$\begin{aligned}
 \boldsymbol{Power} &amp;= \text{Pr}(\text{Reject} H_0|n_E, n_C, \mu_E, \mu_C, \sigma^2, z_{1-\alpha}) = \\ \\
&amp;= \text{Pr}\left(\frac{\overline{Y}_E-\overline{Y}_C}{\sigma\sqrt{\frac{1}{n_E}+\frac{1}{n_C}}} &gt; z_{1-\alpha}\right) \underset{\text{under }H_1}{=} \\
&amp;\underset{\text{under }H_1}{=} \text{Pr}\left(\underbrace{\frac{\overline{Y}_E-\overline{Y}_C - (\mu_E-\mu_C)}{\sigma\sqrt{\frac{1}{n_E}+\frac{1}{n_C}}}}_{Z_0\sim N(0, 1)\text{ with c.d.f. }\Phi(z)} + \underbrace{\frac{(\mu_E-\mu_C)}{\sigma\sqrt{\frac{1}{n_E}+\frac{1}{n_C}}}}_{\Delta &gt; 0 \text{ (}\mu_E&gt;\mu_C\text{ under }H_1\text{)}} &gt; z_{1-\alpha}\right) = \\ \\
&amp;= \text{Pr}\left(Z_0+\Delta &gt; z_{1-\alpha}\right) = 1-\Phi\left(z_{1-\alpha}-\Delta\right) \Rightarrow
\end{aligned}$$`

--

`$$\\ \boxed{\max_{\rho \in (0, 1)}\boldsymbol{Power} \Leftrightarrow \min_{\rho \in (0, 1)}\Phi\left(z_{1-\alpha}-\Delta\right) \Leftrightarrow \max_{\rho \in (0, 1)}\Delta}$$`
---

# Which allocation maximizes power? (2 of 2)

- `\(\max\limits_{\rho \in (0,1)}\Delta = \max\limits_{\rho \in (0,1)}\frac{\mu_E-\mu_C}{\sigma\sqrt{\frac{1}{n\rho}+\frac{1}{n(1-\rho)}}}\)`.

- Equivalently, `\(\min\limits_{\rho \in (0,1)}\left(\frac{1}{n\rho}+\frac{1}{n(1-\rho)}\right)\)`.

- Optimal solution is `\(\boldsymbol{\rho^* = \frac{1}{2}}\)` (_**equal allocation**_).

&lt;span style="background-color: #2F4F4F; color:white"&gt;
Therefore, for a 2-arm comparative trial with normal outcomes (with known variance, common to 2 groups), equal allocation `\(\left(n_E=n_c=\frac{n}{2}\right)\)` maximizes the power of `\(Z\)`-test for treatment comparison.
&lt;/span&gt;

.footnote[
[**Note**] Same result is obtained, if we consider a 2-sample `\(t\)`-test instead of `\(Z\)`-test.
]

---

# Which allocation maximizes power? -- Demo 

&lt;img src="lecture02_files/figure-html/power-equal-1.png" style="display: block; margin: auto;" /&gt;

---

# What if group variances are unequal? (1 of 2)

- `\(Y_{ik}\sim Normal(\mu_k, \sigma_k^2)\)`, `\(k = E, C\)`; `\(i = 1, 2, \ldots, n_k\)`.

  - `\(\boldsymbol{\sigma_k}\)` **assumed to be known**, but depends on the treatment group.

- To test `\(H_0: \mu_E = \mu_C\)` vs. `\(H_1: \mu_E &gt; \mu_C\)`. Reject `\(H_0\)` at level `\(\alpha\)`, if `\(Z=\frac{\overline{Y}_E-\overline{Y}_C}{\sqrt{\frac{\sigma^2_E}{n_E}+\frac{\sigma^2_C}{n_C}}} &gt; z_{1-\alpha}\)` ( `\(Z\)`-test)

`$$\begin{aligned}
\boldsymbol{Power} &amp;= \text{Pr}\left(\text{Reject } H_0| n_E, n_C, \mu_E, \mu_C, \sigma_E, \sigma_C, z_{1-\alpha}\right) = \\
&amp;= 1-\Phi\left(z_{1-\alpha}-\Delta\right)\text{ }\left(\Delta = \frac{\mu_E-\mu_C}{\sqrt{\frac{\sigma^2_E}{n_E}+\frac{\sigma^2_C}{n_C}}}\right)
\end{aligned}$$`

--

`$$\\ \boxed{\max_{\rho \in (0, 1)}\boldsymbol{Power} \Leftrightarrow \min_{\rho \in (0, 1)}\Phi\left(z_{1-\alpha}-\Delta\right) \Leftrightarrow \max_{\rho \in (0, 1)}\Delta}$$`
---

# What if group variances are unequal? (2 of 2)

- `\(\max\limits_{\rho \in (0,1)}\Delta = \max\limits_{\rho \in (0,1)}\frac{\mu_E-\mu_C}{\sqrt{\frac{\sigma^2_1}{n\rho}+\frac{\sigma^2_2}{n(1-\rho)}}}\)`
- Equivalently, `\(\min\limits_{\rho \in (0,1)}\left(\frac{\sigma^2_1}{n\rho}+\frac{\sigma^2_2}{n(1-\rho)}\right)\)`
- Optimal solution is `\(\boldsymbol{\rho_N^* = \frac{\sigma_E}{\sigma_E+\sigma_C}}\)` ([_**Neyman allocation**_](https://en.wikipedia.org/wiki/Jerzy_Neyman))

&lt;span style="background-color: #2F4F4F; color:white"&gt;
More variable treatment group receives greater proportion of study patients.
&lt;/span&gt;
 
---

# What if group variances are unequal? -- Demo 

&lt;img src="lecture02_files/figure-html/power-unequal-1.png" style="display: block; margin: auto;" /&gt;
---

# Example: Binary outcome trial

`\(Y_{ik}\sim Bernoulli(p_k)\)`; `\(k = E, C\)`; `\(i = 1, 2, \ldots, n_k\)`:

- `\(p_k\)` = probability of a "success" in the `\(k^\text{th}\)` group.
- Denote `\(q_k = 1-p_k\)` = probability of a "failure" in the `\(k^\text{th}\)` group.
    
We want to test `\(H_0: p_E = p_C\)` vs. `\(p_E &gt; p_C\)` by using (asymptotic) `\(Z\)`-test:

- Reject `\(H_0\)` at level `\(\alpha\)`, if `\(Z=\frac{\widehat{p}_E-\widehat{p}_C}{\sqrt{\frac{\widehat{p}_E\widehat{q}_E}{n_E}+\frac{\widehat{p}_C\widehat{q}_C}{n_C}}} &gt; z_{1-\alpha}\)` (where `\(\widehat{p}_k, \widehat{q}_k\)` are sample proportions).
- Asymptotically `\(\widehat{p}_k \rightarrow p_k\)`, `\(\widehat{p}_k\widehat{q}_k \rightarrow p_kq_k\)`, all our derivations (developed in the normal outcome case) still apply here.
    
Note that `\(\text{E}\left[Y_{ik}\right]=p_k\)` and `\(\text{Var}\left[Y_{ik}\right]=p_kq_k\)` (variances are possibly different in two groups).

`$$\boxed{\textit{Neyman allocation: } \rho_N^* = \frac{\sqrt{p_Eq_E}}{\sqrt{p_Eq_E}+\sqrt{p_Cq_C}}}$$`
---

# Example: Binary outcome trial -- Demo 

&lt;img src="lecture02_files/figure-html/power-binary-1.png" style="display: block; margin: auto;" /&gt;

---
class: middle

**Q**: What is a major limitation of Neyman allocation `\(\rho^* = \frac{\sqrt{p_Eq_E}}{\sqrt{p_Eq_E}+\sqrt{p_Cq_C}}\)`?

**A**: The model parameters _**are unknown**_ to us! We are conducting the trial to gain information about `\(p_E\)` and `\(p_C\)`. Thus Neyman allocation cannot be implemented directly!


---
class: inverse, center, middle

# 2. Maximizing estimation precision of treatment effects and contrasts

---

# Maximizing estimation precision

- `\(K \geq 2\)` treatment groups (e.g. different doses of a drug or different intervention strategies).

- Primary outcome: `\(Y_{ik}\)` follows some distribution from an exponential family (e.g. Normal, Bernoulli, Poisson, exponential, etc.)

- `\(\mathbf{E}\left[Y_{ik}\right] = \mu_k\)`, `\(\mathbf{Var}\left[Y_{ik}\right] = \sigma^2_k\)`, `\(k = 1, 2, \ldots, K\)`.

- Study objectives:
  + The vector of mean treatment effects `\(\boldsymbol{\mu} = (\mu_1, \mu_2, \ldots, \mu_K)\)`.
  + The vector of treatment contrasts `\(\boldsymbol{\mu}_C = (\mu_2-\mu_1, \ldots, \mu_K-\mu_1)\)`.
  + etc.

---

# Design Optimization (1 of 2)

Allocation design: `\(\boldsymbol{\rho}=(\rho_1, \rho_2, \ldots, \rho_K)\)`, `\(0 \leq \rho_k \leq 1\)` and `\(\sum_{k=1}^K{\rho_k} = 1\)`:

- `\(\rho_k\)` = target allocation proportion for the `\(k^\text{th}\)` treatment group
- `\(n\rho_k\)` = sample size of the `\(k^\text{th}\)` group (integer-rounded, if necessary)
 
Design Fisher Information Matrix: `$$\boldsymbol{M}(\boldsymbol{\rho}) = n\times diag\left\{\frac{\rho_1}{\sigma^2_1}, \frac{\rho_2}{\sigma^2_2}, \ldots, \frac{\rho_K}{\sigma^2_K}\right\}$$`

---

# Design Optimization (1 of 2)

Variance-covariance matrix of a consistent estimator (MLE) `\(\widehat{\boldsymbol{\mu}}=\left(\widehat{\mu}_1, \widehat{\mu}_2, \ldots, \widehat{\mu}_K\right)\)` of `\(\boldsymbol{\mu}=\left(\mu_1, \mu_2, \ldots, \mu_K\right)\)`:

`$$\mathbf{Var}\left[\widehat{\boldsymbol{\mu}}\right]=\boldsymbol{M}^{-1}(\boldsymbol{\rho}) = \frac{1}{n}diag\left\{\frac{\sigma^2_1}{\rho_1}, \frac{\sigma^2_2}{\rho_2}, \ldots, \frac{\sigma^2_K}{\rho_K} \right\}$$`

Variance-covariance matrix of a consistent estimator of the contrast vector `\(\boldsymbol{\mu}_C = \boldsymbol{A}^T\boldsymbol{\mu}=(\mu_2-\mu_1, \ldots, \mu_K-\mu_1)\)`: 

`$$\mathbf{Var}\left[\boldsymbol{A}^T\widehat{\boldsymbol{\mu}}\right]=\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho})\boldsymbol{A} = \frac{1}{n}\left(diag\left\{\frac{\sigma^2_2}{\rho_2}, \ldots, \frac{\sigma^2_K}{\rho_K} \right\}+\frac{\sigma^2_1}{\rho_1}\mathbf{1}\mathbf{1}^T\right),$$`
where `\(\boldsymbol{A}\)` is a contrast matrix.

---

## Design Optimization (2 of 2)

We are interested in minimizing "variability" of an estimated parameter of interest.

An optimal design problem is to find an allocation `\(\boldsymbol{\rho}=\left(\rho_1, \rho_2,  \ldots, \rho_K\right)\)` that minimizes some criterion of `\(\boldsymbol{M}^{-1}(\boldsymbol{\rho})\)` (or `\(\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho})\boldsymbol{A}\)`) subject to constraints `\(0 \leq \rho_k \leq 1\)` and `\(\sum_{k=1}^K{\rho_k}=1\)`:

- _**D-optimal**_: `\(\min\limits_{\boldsymbol{\rho}}\left\{\text{det}\boldsymbol{M}^{-1}(\boldsymbol{\rho})\right\}\)` (volume of the confidence ellipsoid for `\(\boldsymbol{\mu}\)`).
- _**A-optimal**_: `\(\min\limits_{\boldsymbol{\rho}}\left\{\text{trace}\boldsymbol{M}^{-1}(\boldsymbol{\rho})\right\}\)` (sum of the lengths of the major axes in the confidence ellipsoid for `\(\boldsymbol{\mu}\)`).
- _**D&lt;sub&gt;A&lt;/sub&gt;-optimal**_: `\(\min\limits_{\boldsymbol{\rho}}\left\{\text{det}\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho})\boldsymbol{A}\right\}\)` (volume of the confidence ellipsoid for contrast vector `\(\boldsymbol{\mu}_C\)`).
- _**A&lt;sub&gt;A&lt;/sub&gt;-optimal**_: `\(\min\limits_{\boldsymbol{\rho}}\left\{\text{trace}\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho})\boldsymbol{A}\right\}\)` (sum of the lengths of the major axes in the confidence ellipsoid for contrast vector `\(\boldsymbol{\mu}_C\)`).

Some of these problems can be solved _**analytically**_ (e.g., by using Lagrange multiplier minimization).

---

# D-Optimal Allocation

`$$\min\limits_{\boldsymbol{\rho}}\left\{\text{det}\boldsymbol{M}^{-1}(\boldsymbol{\rho})\right\}=\min\limits_{\boldsymbol{\rho}}\left\{\frac{\sigma^2_1}{\rho_1}\cdot\frac{\sigma^2_2}{\rho_2}\cdot\ldots\cdot\frac{\sigma^2_K}{\rho_K}\right\}$$`

Equivalently: `\(\max\limits_{\boldsymbol{\rho}}\left\{\rho_1\cdot\rho_2\cdot\ldots\cdot\rho_K\right\}\)`.

By the geometric-arithmetic mean inequality: 
`$$\left(\rho_1\cdot\rho_2\cdot\ldots\cdot\rho_K\right)^\frac{1}{K}\leq\frac{1}{K}\sum_{k=1}^K{\rho_k}=\frac{1}{K}\Rightarrow \rho_1\cdot\rho_2\cdot\ldots\cdot\rho_K \leq \left(\frac{1}{K}\right)^K.$$`

&lt;span style="background-color: #2F4F4F; color:white"&gt;
Thus, an equal allocation design `\(\boldsymbol{\rho}=\left(\frac{1}{K}, \ldots, \frac{1}{K}\right)\)` is D-optimal.
&lt;/span&gt;

---

# A-Optimal Allocation

`$$\min\limits_{\boldsymbol{\rho}}\left\{\text{trace}\boldsymbol{M}^{-1}(\boldsymbol{\rho})\right\}=\min\limits_{\boldsymbol{\rho}}\left\{\frac{\sigma^2_1}{\rho_1}+\frac{\sigma^2_2}{\rho_2}+\ldots+\frac{\sigma^2_K}{\rho_K}\right\}$$`

Lagrange multiplier minimization: 
`$$\frac{\partial}{\partial{\rho_k}}\left\{\sum_{k=1}^K{\frac{\sigma^2_k}{\rho_k}+\lambda\left(\sum_{k=1}^K{\rho_k}-1\right)}\right\}=-\frac{\sigma^2_k}{\rho_k^2}+\lambda,\quad k = 1, 2, \ldots, K.$$`

Setting the derivatives to zero, and using `\(\sum_{k=1}^K{\rho_k} = 1\)`, we find the A-optimal allocation as `$$\rho^{(A)}_k=\frac{\sigma_k}{\sum_{i=1}^K{\sigma_i}}, \quad k = 1, 2, \ldots, K.$$`

- If `\(K = 2\)`, an optimal allocation is the _**Neyman allocation**_!

- If `\(\sigma^2_k\)`'s are all equal, an optimal allocation is the _**equal allocation**_!

---

# D&lt;sub&gt;A&lt;/sub&gt;-Optimal Allocation

`$$\min\limits_{\boldsymbol{\rho}}\left\{\text{det}\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho})\boldsymbol{A}\right\} =\min\limits_{\boldsymbol{\rho}}\text{det}\left\{diag\left\{\frac{\sigma^2_2}{\rho_2}, \ldots, \frac{\sigma^2_K}{\rho_K} \right\}+\frac{\sigma^2_1}{\rho_1}\mathbf{1}\mathbf{1}^T\right\}.$$`

- Optimal solution is not in closed form.

- Wong and Zhu (2008)&lt;sup&gt;1&lt;/sup&gt; showed that D&lt;sub&gt;A&lt;/sub&gt;-optimal proportions satisfy the following (nonlinear) system of equations:

`$$\frac{1}{\rho^*_k}-\frac{1/\sigma^2_k}{\sum_{i=1}^K{\rho^*_i/\sigma^2_i}}=0, \quad k =1, 2, \ldots, K.$$`

- If `\(\sigma^2_k\)`'s are all equal, the D&lt;sub&gt;A&lt;/sub&gt;-optimal solution is the equal allocation!

.footnote[
[1] Wong, W. K., and Zhu, W.  _"Optimum treatment allocation rules under a
variance heterogeneity model"_. Stat. Med., 27, 4581–4595 (2008).
]

---

# D&lt;sub&gt;A&lt;/sub&gt;-Optimal Allocation -- Some Properties

1. When `\(K = 2\)`, the D&lt;sub&gt;A&lt;/sub&gt;-optimal allocation is Neyman allocation: 
`$$\rho^*_k = \frac{\sigma_k}{\sigma_1+\sigma_2}, \quad k = 1, 2..$$`

2. The D&lt;sub&gt;A&lt;/sub&gt;-optimal proportions satisfy: 
`$$0 \leq \rho^*_k \leq \frac{1}{K-1}, \quad k = 1, 2, \ldots, K.$$`

3. If `\(\sigma^2_k\rightarrow 0\)` and `\(\sigma^2_k/\sigma^2_j\rightarrow 0\)` for all `\(j \ne k\)` (variance in the `\(k\)`-th group is small relative to all other group variances), then `\(\rho^*_k\rightarrow 0\)`.

4. Let the `\(K\)` treatment groups be such that `\(\sigma_1\geq\sigma_2\geq \ldots\sigma_K\)`. Then the D&lt;sub&gt;A&lt;/sub&gt;-optimal proportions satisfy: `\(\rho^*_1\geq\rho^*_2\geq \ldots\rho^*_K\)` (more variable treatment groups receive greater proportions of study subjects).

---

# D&lt;sub&gt;A&lt;/sub&gt;-Optimal Allocation -- Example

- Binary outcome trial, `\(K=3\)` treatment groups.
- `\(p_k\)` probability of a successful outcome in group `\(k = 1, 2, 3\)`.

&lt;table class="table table-striped" style="font-size: 18px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Treatment success probabilities&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt; `\(D_A\)`-optimal allocation proportions&lt;/div&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; `\(p_1\)` &lt;/th&gt;
   &lt;th style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; `\(p_2\)` &lt;/th&gt;
   &lt;th style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; `\(p_3\)` &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; `\(\rho^*_1\)` &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; `\(\rho^*_2\)` &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; `\(\rho^*_3\)` &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.02 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.02 &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: white !important;"&gt;0.43&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: white !important;"&gt;0.285&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: white !important;"&gt;0.285&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.30 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.50 &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: white !important;"&gt;0.263&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: white !important;"&gt;0.36&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: white !important;"&gt;0.377&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.3 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.40 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.60 &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: white !important;"&gt;0.323&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: white !important;"&gt;0.338&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: white !important;"&gt;0.338&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.4 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.60 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.80 &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.349&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.349&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.303&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.7 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.30 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #708090 !important;color: white !important;"&gt; 0.80 &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.344&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.344&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #708090 !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.313&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.9 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.95 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: white !important;background-color: #2F4F4F !important;color: white !important;"&gt; 0.99 &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.427&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.378&lt;/span&gt; &lt;/td&gt;
   &lt;td style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; &lt;span style="     color: orange !important;"&gt;0.196&lt;/span&gt; &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;span style="background-color: #2F4F4F; color:white"&gt;
Q: Based on these results, what is one caveat of the D&lt;sub&gt;A&lt;/sub&gt;-optimal allocation?
&lt;/span&gt;

&lt;span style="background-color: #2F4F4F; color:white"&gt;
A: It can assign greater proportions to less successful treatments (cf. last three examples).
&lt;/span&gt;

---

# A&lt;sub&gt;A&lt;/sub&gt;-Optimal Allocation    

`$$\min\limits_{\boldsymbol{\rho}}\left\{\text{trace}\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho})\boldsymbol{A}\right\}=\min\limits_{\boldsymbol{\rho}}\left\{\frac{\sigma^2_2}{\rho_2}+\frac{\sigma^2_3}{\rho_3}+\ldots+\frac{\sigma^2_K}{\rho_K}+(K-1)\frac{\sigma^2_1}{\rho_1}\right\}$$`

Lagrange multiplier minimization: 

`$$\begin{aligned}&amp;\frac{\partial}{\partial{\rho_k}}\left\{\sum_{k=2}^K{\frac{\sigma^2_k}{\rho_k}+(K-1)\frac{\sigma^2_1}{\rho_1}+\lambda\left(\sum_{k=1}^K{\rho_k}-1\right)}\right\}= \\
&amp;=\left\{\begin{array}{cl}-(K-1)\frac{\sigma^2_1}{\rho_1^2}+\lambda, &amp; k = 1 \\
-\frac{\sigma^2_k}{\rho_k^2}+\lambda, &amp; k = \overline{2, K}\end{array}\right.\end{aligned}$$`
---

# A&lt;sub&gt;A&lt;/sub&gt;-Optimal Allocation   

Setting the derivatives to zero, and using `\(\sum_{k=1}^K{\rho_k} = 1\)`, we find the A&lt;sub&gt;A&lt;/sub&gt;-optimal allocation as 

`$$\rho^{(A)}_k=\left\{\begin{array}{cl}
\frac{\sigma_1\sqrt{K-1}}{\sigma_1\sqrt{K-1}+\sum_{i=2}^K{\sigma_i}}, &amp; k = 1\\
\frac{\sigma_k}{\sigma_1\sqrt{K-1}+\sum_{i=2}^K{\sigma_i}}, &amp; k = \overline{2, K}\end{array}
\right.$$`


- If `\(K = 2\)`, an optimal allocation is the _**Neyman allocation**_!

---

# Summary of Optimal Allocation Ratios&lt;sup&gt;*&lt;/sup&gt;

&lt;table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #6666ff !important;background-color: #2F4F4F !important;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #6666ff !important;background-color: #2F4F4F !important;"&gt; K &amp;gt; 2 &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #6666ff !important;background-color: #2F4F4F !important;"&gt; Unequal variances (K = 2) &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #6666ff !important;background-color: #2F4F4F !important;"&gt; Unequal variances (K &amp;gt; 2) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #708090 !important;color: white !important;"&gt; D-optimal &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #708090 !important;color: white !important;"&gt; `\(1:1:\ldots:1\)` &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #708090 !important;color: white !important;"&gt; `\(1:1\)` &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #708090 !important;color: white !important;"&gt; `\(1:1:\ldots:1\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #2F4F4F !important;color: white !important;"&gt; A-optimal &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #2F4F4F !important;color: white !important;"&gt; `\(1:1:\ldots:1\)` &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #2F4F4F !important;color: white !important;"&gt; `\(\sigma_1:\sigma_2\)` &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #2F4F4F !important;color: white !important;"&gt; `\(\sigma_1:\sigma_2:\ldots:\sigma_K\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #708090 !important;color: white !important;"&gt; D&lt;sub&gt;A&lt;/sub&gt;-optimal &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #708090 !important;color: white !important;"&gt; `\(1:1:\ldots:1\)` &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #708090 !important;color: white !important;"&gt; `\(\sigma_1:\sigma_2\)` &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #708090 !important;color: white !important;"&gt; No closed form  solution;must be found numerically &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #2F4F4F !important;color: white !important;"&gt; A&lt;sub&gt;A&lt;/sub&gt;-optimal &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #2F4F4F !important;color: white !important;"&gt; `\(\sqrt{K-1}:1:\ldots:1\)` &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #2F4F4F !important;color: white !important;"&gt; `\(\sigma_1:\sigma_2\)` &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #2F4F4F !important;color: white !important;"&gt; `\(\sigma_1\sqrt{K-1}:\sigma_2:\ldots:\sigma_K\)` &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.footnote[
[*] An allocation ratio `\(C_1:C_2:\ldots:C_K\)` corresponds to the vector pf allocation proportions `\(\boldsymbol{\rho}=\left(\frac{C_1}{\sum_{k=1}^K{C_k}}, \frac{C_2}{\sum_{k=1}^K{C_k}}, \ldots, \frac{C_K}{\sum_{k=1}^K{C_k}}\right)\)`
] 

---

# Relative Efficiency

- Suppose we want to compare two allocation designs: `\(\boldsymbol{\rho}^{(1)}\)` and `\(\boldsymbol{\rho}^{(2)}\)` w.r.t. a given design criterion
- The relative efficiencies (of `\(\boldsymbol{\rho}^{(1)}\)` vs. `\(\boldsymbol{\rho}^{(2)}\)`) are defined as follows:

&lt;table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Relative D-efficiency &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Relative A-efficiency &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Relative D&lt;sub&gt;A&lt;/sub&gt;-efficiency &lt;/th&gt;
   &lt;th style="text-align:left;font-weight: bold;color: white !important;background-color: #2F4F4F !important;"&gt; Relative A&lt;sub&gt;A&lt;/sub&gt;-efficiency &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;color: white !important;background-color: #708090 !important;"&gt; `\(\left(\frac{\text{det}\{\boldsymbol{M}^{-1}(\boldsymbol{\rho}^{(2)})\}}{\text{det}\{\boldsymbol{M}^{-1}(\boldsymbol{\rho}^{(1)})\}}\right)^{1/K}\)` &lt;/td&gt;
   &lt;td style="text-align:left;color: white !important;background-color: #708090 !important;"&gt; `\(\frac{\text{trace}\{\boldsymbol{M}^{-1}(\boldsymbol{\rho}^{(2)})\}}{\text{trace}\{\boldsymbol{M}^{-1}(\boldsymbol{\rho}^{(1)})\}}\)` &lt;/td&gt;
   &lt;td style="text-align:left;color: white !important;background-color: #708090 !important;"&gt; `\(\left(\frac{\text{det}\{\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho}^{(2)})\boldsymbol{A}\}}{\text{det}\{\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho}^{(1)})\boldsymbol{A}\}}\right)^{1/\text{rank}(A)}\)` &lt;/td&gt;
   &lt;td style="text-align:left;color: white !important;background-color: #708090 !important;"&gt; `\(\frac{\text{trace}\{\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho}^{(2)})\boldsymbol{A}\}}{\text{trace}\{\boldsymbol{A}^T\boldsymbol{M}^{-1}(\boldsymbol{\rho}^{(1)})\boldsymbol{A}\}}\)` &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

- An allocation that is highly efficient under one criterion may have poor performance under other criteria.

  - Therefore, clear understanding of study objectives is essential!

---

# Example -- Efficiency of Equal Allocation

- Binary outcome trial, `\(K=3\)` treatment groups

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="lecture02_files/figure-html/efficiency-of-equal-allocation-1.png" alt="Relative efficiencies heatmap plots"  /&gt;
&lt;p class="caption"&gt;Relative efficiencies heatmap plots&lt;/p&gt;
&lt;/div&gt;

---
class: inverse, center, middle

# Thank you!

[**Back to the course page**](index.html)

.footnote[
Slides are created via the R package [**xaringan**](https://github.com/yihui/xaringan).
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
